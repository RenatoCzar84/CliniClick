{% extends "base/base.html" %}
{% block title %}Painel | Cliniclick{% endblock %}

{% block content %}
<div class="painel-skin"><!-- wrapper para isolar o estilo do painel -->

  <!-- LINHA 1: Perfil (esq) + Meus agendamentos (dir) -->
  <div class="row g-4 py-4">

    <!-- Meu Perfil -->
    <div class="col-12 col-lg-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-primary text-white text-center py-3">
          <strong class="fancy-title mb-0 fs-5">Meu Perfil</strong>
        </div>

        <div class="card-body">
          <ul class="list-unstyled mb-0 perfil-list">
            <li class="mb-3 d-flex align-items-center">
              <i class="bi bi-person me-3 text-brand perfil-icone"></i>
              <div><span class="text-muted">Usuário:</span> <strong class="ms-1">{{ request.user.username }}</strong></div>
            </li>
            <li class="mb-3 d-flex align-items-center">
              <i class="bi bi-card-text me-3 text-brand perfil-icone"></i>
              <div><span class="text-muted">Nome:</span> <strong class="ms-1">{{ request.user.first_name }} {{ request.user.last_name }}</strong></div>
            </li>
            <li class="mb-3 d-flex align-items-center">
              <i class="bi bi-cake2 me-3 text-brand perfil-icone"></i>
              <div><span class="text-muted">Idade:</span> <strong class="ms-1">{{ idade|default:"–" }}</strong></div>
            </li>
            <li class="mb-1 d-flex align-items-center">
              <i class="bi bi-shield-plus me-3 text-brand perfil-icone"></i>
              <div><span class="text-muted">Plano de Saúde:</span> <strong class="ms-1">{{ request.user.plano_saude|default:"–" }}</strong></div>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Meus agendamentos -->
    <div class="col-12 col-lg-8">
      
      <div class="card shadow-sm h-100">
        <div class="card-header bg-primary text-white text-center py-3">
          <strong class="fancy-title mb-0 fs-5">Meus Agendamentos</strong>
        </div>

        <div class="card-body">
          <ul class="nav nav-pills mb-3" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link {% if tab != 'anteriores' %}active{% endif %}"
                      data-bs-toggle="tab" data-bs-target="#pane-prox" type="button" role="tab">
                Próximos
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link {% if tab == 'anteriores' %}active{% endif %}"
                      data-bs-toggle="tab" data-bs-target="#pane-ant" type="button" role="tab">
                Anteriores
              </button>
            </li>
          </ul>

          <div class="tab-content">
            <!-- Próximos -->
            <div class="tab-pane fade {% if tab != 'anteriores' %}show active{% endif %}" id="pane-prox" role="tabpanel">
              <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>Tipo</th>
                      <th>Alvo</th>
                      <th>Médico</th>
                      <th>Data e Hora</th>
                      <th class="text-end">Ações</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for a in prox_agendamentos %}
                    <tr>
                      <td>{{ a.get_tipo_display }}</td>
                      <td>{% if a.tipo == 'consulta' %}{{ a.especialidade.nome }}{% else %}{{ a.exame_tipo.nome }}{% endif %}</td>
                      <td>{% if a.medico %}{{ a.medico.nome }}{% else %}—{% endif %}</td>
                      <td>{{ a.data_hora|date:"d/m/Y H:i" }}</td>
                      <td class="text-end">
                        <a class="btn btn-sm btn-outline-primary" href="{% url 'agenda:editar_agendamento' a.pk %}">
                          <i class="bi bi-pencil-square"></i> Editar
                        </a>
                        <form class="d-inline" method="post" action="{% url 'agenda:excluir_agendamento' a.pk %}" onsubmit="return confirm('Excluir este agendamento?');">
                          {% csrf_token %}
                          <button class="btn btn-sm btn-outline-danger" type="submit">
                            <i class="bi bi-trash"></i> Excluir
                          </button>
                        </form>
                      </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="5" class="text-center text-muted">Nenhum agendamento futuro.</td></tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Anteriores -->
            <div class="tab-pane fade {% if tab == 'anteriores' %}show active{% endif %}" id="pane-ant" role="tabpanel">
              <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>Tipo</th>
                      <th>Alvo</th>
                      <th>Médico</th>
                      <th>Data e Hora</th>
                      <th class="text-end">Ações</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for a in ant_agendamentos %}
                    <tr>
                      <td>{{ a.get_tipo_display }}</td>
                      <td>{% if a.tipo == 'consulta' %}{{ a.especialidade.nome }}{% else %}{{ a.exame_tipo.nome }}{% endif %}</td>
                      <td>{% if a.medico %}{{ a.medico.nome }}{% else %}—{% endif %}</td>
                      <td>{{ a.data_hora|date:"d/m/Y H:i" }}</td>
                      <td class="text-end">
                        <a class="btn btn-sm btn-outline-primary" href="{% url 'agenda:editar_agendamento' a.pk %}">
                          <i class="bi bi-pencil-square"></i> Editar
                        </a>
                        <form class="d-inline" method="post" action="{% url 'agenda:excluir_agendamento' a.pk %}" onsubmit="return confirm('Excluir este agendamento?');">
                          {% csrf_token %}
                          <button class="btn btn-sm btn-outline-danger" type="submit">
                            <i class="bi bi-trash"></i> Excluir
                          </button>
                        </form>
                      </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="5" class="text-center text-muted">Sem registros anteriores.</td></tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>

          </div><!-- /.tab-content -->
        </div><!-- /.card-body -->
      </div><!-- /.card -->

  </div><!-- /.row (linha 1) -->

  <!-- LINHA 2: Ações rápidas embaixo -->
  <div class="row g-3 pt-0">

    <div class="col-12 col-md-6">
      <a class="text-decoration-none" href="{% url 'agenda:agendar_consulta' %}">
        <div class="card shadow-sm h-100 card-cta">
          <div class="card-body d-flex align-items-center gap-3">
            <i class="bi bi-clipboard2-check text-primary card-cta-icone"></i>
            <div>
              <h5 class="mb-1">Agendar Consulta</h5>
              <div class="text-muted">Especialidade, médico, data e horário</div>
            </div>
          </div>
        </div>
      </a>
    </div>

    <div class="col-12 col-md-6">
      <a class="text-decoration-none" href="{% url 'agenda:agendar_exame' %}">
        <div class="card shadow-sm h-100 card-cta">
          <div class="card-body d-flex align-items-center gap-3">
            <i class="bi bi-clipboard2-pulse text-success card-cta-icone"></i>
            <div>
              <h5 class="mb-1">Agendar Exame</h5>
              <div class="text-muted">Escolha o exame, data e horário</div>
            </div>
          </div>
        </div>
      </a>
    </div>
  </div><!-- /.row (linha 2) -->

    </div><!-- /.col lg-8 -->
</div><!-- /.painel-skin -->
{% endblock %}
